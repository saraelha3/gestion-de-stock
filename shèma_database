-- Création de la base de données
CREATE DATABASE IF NOT EXISTS gestion_stock;
USE gestion_stock;

-- Table des utilisateurs
CREATE TABLE utilisateurs (
    id INT AUTO_INCREMENT PRIMARY KEY,
    nom_utilisateur VARCHAR(50) NOT NULL UNIQUE,
    mot_de_passe VARCHAR(255) NOT NULL,
    role ENUM('admin', 'employe') NOT NULL
);

-- Table des catégories de pièces
CREATE TABLE categories (
    id INT AUTO_INCREMENT PRIMARY KEY,
    nom VARCHAR(100) NOT NULL
);

-- Table des fournisseurs
CREATE TABLE fournisseurs (
    id INT AUTO_INCREMENT PRIMARY KEY,
    nom VARCHAR(100) NOT NULL,
    contact VARCHAR(100),
    telephone VARCHAR(20),
    email VARCHAR(100)
);

-- Table des pièces
CREATE TABLE pieces (
    id INT AUTO_INCREMENT PRIMARY KEY,
    nom VARCHAR(100) NOT NULL,
    id_categorie INT,
    id_fournisseur INT,
    quantite INT DEFAULT 0,
    stock_minimum INT DEFAULT 0,
    description TEXT,
    FOREIGN KEY (id_categorie) REFERENCES categories(id),
    FOREIGN KEY (id_fournisseur) REFERENCES fournisseurs(id)
);

-- Table des mouvements de stock (entrées/sorties)
CREATE TABLE mouvements (
    id INT AUTO_INCREMENT PRIMARY KEY,
    id_piece INT NOT NULL,
    type ENUM('entree', 'sortie') NOT NULL,
    quantite INT NOT NULL,
    date DATETIME DEFAULT CURRENT_TIMESTAMP,
    id_utilisateur INT,
    commentaire TEXT,
    FOREIGN KEY (id_piece) REFERENCES pieces(id),
    FOREIGN KEY (id_utilisateur) REFERENCES utilisateurs(id)
);

-- Table des logs (historique des actions)
CREATE TABLE logs (
    id INT AUTO_INCREMENT PRIMARY KEY,
    action VARCHAR(255) NOT NULL,
    id_utilisateur INT,
    date DATETIME DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (id_utilisateur) REFERENCES utilisateurs(id)
);